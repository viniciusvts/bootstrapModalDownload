/*! Vinicius de Santana <vinicius.vts@gmail.com> */
!function(o,t){o.modalDownload=function(o,e=null){new class{constructor(o,t=null){this.url=o,this.fileName=t||o.split("/").pop().split("?")[0]||"download",this.start()}start(){if("function"!=typeof $)throw new Error("BootstrapModalDownload funciona com bootstrap e JQuery");this.createModal(),this.getUrl()}getUrl(){this.title.innerText="Gerando arquivo...",this.controller=new AbortController,fetch(this.url,{signal:this.controller.signal}).then(o=>{if(o.ok)return o.blob();throw new Error("Response not OK")}).then(o=>{this.blob=o,this.title.innerText="Arquivo gerado.",this.modalBody.innerHTML="",this.downloadButton.href=URL.createObjectURL(this.blob),this.downloadButton.download=this.fileName,this.downloadButton.classList.remove("hide")}).catch(o=>{this.title.innerText="Houve um erro, tente novamente.",this.modalBody.innerHTML=""})}download(){location.assign(this.blobURL)}closeDownload(){this.modal.remove(),this.controller.abort(),this.blob&&URL.revokeObjectURL(this.blob)}createModal(){const o=t.createElement("div");o.classList.add("modal","fade"),o.innerHTML='<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h5 class="modal-title">Carregando...</h5></div><div class="modal-body" style="display:flex"><div class="loader"></div></div><div class="modal-footer"><a href="#" download class="btn bg-green waves-effect border-radius-5 download hide">Download</a><button type="button" class="btn bg-orange waves-effect border-radius-5" data-dismiss="modal">Fechar</button></div></div></div><style>.loader{margin:auto;border:10px solid #EAF0F6;border-radius:50%;border-top:10px solid #1565C0;width:50px;height:50px;animation:spinner 1s linear infinite;}@keyframes spinner{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style>';const e=o.querySelector("h5.modal-title");t.body.appendChild(o),$(o).modal("show"),$(o).on("hidden.bs.modal",o=>{this.closeDownload()}),this.modal=o,this.title=e,this.modalBody=o.querySelector(".modal-body"),this.downloadButton=o.querySelector("a.download")}}(o,e)}}(window,document);